---
title: "About"
---

# load packages
```{r, message = FALSE}
library(tidyverse)
library(readr)
library(readxl)
```

# settings
```{r, message = FALSE}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "right"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Load cleaned tree data
Each line is an individual tree
```{r, message = FALSE}
tree_2015_cleaned <-
  read_csv("large_tree_data/2015_tree_raw.csv", na = c("", "NA", "Unknown")) |> 
  janitor::clean_names() |> 
  select(-created_at, -steward, -user_type, -st_senate, -st_assem, -state) 

 
```

# Load acres data
focusing just on 2010; uses 2010 NTAs
```{r}
acres_raw <- 
  read_excel("small_data/t_pl_p5_nta.xlsx", 
             range = "A9:J203", 
             col_names = c("borough", "county_code", "nta", "nta_name",
                           "total_pop_2000", "total_pop_2010", "pop_change_num",
                           "pop_change_per", "total_acres", "persons_per_acre")
             ) |> 
  janitor::clean_names()

acres_sub <- acres_raw |> 
  select(nta_name, total_acres)

```

# Create table summarizing number of trees per acre by nta
looking at only Alive trees; 6 NTAs from our tree census are missing acreage info so we removed these NTA from the analysis
```{r}
trees_per_nta <- tree_2015_cleaned |> 
  select(nta_name, nta, status) |> 
  filter(status == "Alive") |> 
  count(nta_name) |> 
  rename(num_trees = n)

trees_and_acres <- left_join(trees_per_nta, acres_sub, by = "nta_name")

num_missing_nta <- sum(is.na(trees_and_acres$total_acres))

trees_per_acre_df <- trees_and_acres |> 
  filter(!is.na(total_acres)) |> 
  mutate(trees_per_acre = num_trees/total_acres) |> 
  arrange(desc(trees_per_acre))


```

## Asthma Emergency Dept Adults 2017-2019
### load Asthma Emergency Dept Adults 2017-2019
```{r}
asthma_ed_adults_raw = 
  read_csv("small_data/NYC EH Data Portal_Asthma emergency department visits adults.csv") |> 
  janitor::clean_names()

asthma_ed_adults_clean = asthma_ed_adults_raw |> 
  rename(nta_name = geography) |> 
  filter(geo_type == "NTA2010" & time == "2017-2019") |> 
  select(nta_name, average_annual_age_adjusted_rate_per_10_000, average_annual_rate_per_10_000, average_annual_number)

```

### Summarize trees per acre by nta and asthma emergency dept adults
checked and no NAs are present
```{r}
trees_and_asthma_ed_adult <- left_join(trees_per_acre_df, asthma_ed_adults_clean, by = "nta_name")

miss <- sum(is.na(trees_and_asthma_ed_adult))

```

### Tables and Graphs of trees per acre and asthma ED adults and num trees
when looking at histograms of x and y values most are skewed; can't do a test of significance
no to weak linear association
```{r}
trees_and_asthma_ed_adult |> 
  select(nta_name, num_trees, total_acres, trees_per_acre, average_annual_age_adjusted_rate_per_10_000) |> 
  arrange(desc(trees_per_acre)) |> 
  filter(min_rank(desc(trees_per_acre)) < 11) |> 
  knitr::kable(digits = 2, caption = "Top 10 neighborhoods with most trees per acre and their asthma ED adult rate")

trees_and_asthma_ed_adult |> 
  select(nta_name, num_trees, total_acres, trees_per_acre, average_annual_age_adjusted_rate_per_10_000) |> 
  arrange((trees_per_acre)) |> 
  filter(min_rank(trees_per_acre) < 11) |> 
  knitr::kable(digits = 2, caption = "Top 10 neighborhoods with least trees per acre and their asthma ED adult rate")

trees_and_asthma_ed_adult |> 
  ggplot(aes(x = trees_per_acre, y = average_annual_age_adjusted_rate_per_10_000)) +
  geom_point() +
  geom_smooth(se = FALSE)

cor(pull(trees_and_asthma_ed_adult, trees_per_acre), pull(trees_and_asthma_ed_adult, average_annual_age_adjusted_rate_per_10_000))

trees_and_asthma_ed_adult |> 
  ggplot(aes(x = num_trees, y = average_annual_age_adjusted_rate_per_10_000)) +
  geom_point() +
  geom_smooth(se = FALSE)

cor(pull(trees_and_asthma_ed_adult, num_trees), pull(trees_and_asthma_ed_adult, average_annual_age_adjusted_rate_per_10_000))

trees_and_asthma_ed_adult |> 
  ggplot(aes(x = trees_per_acre, y = average_annual_rate_per_10_000)) +
  geom_point() +
  geom_smooth(se = FALSE)

cor(pull(trees_and_asthma_ed_adult, trees_per_acre), pull(trees_and_asthma_ed_adult, average_annual_rate_per_10_000))

trees_and_asthma_ed_adult |> 
  ggplot(aes(x = num_trees, y = average_annual_rate_per_10_000)) +
  geom_point() +
  geom_smooth(se = FALSE)

cor(pull(trees_and_asthma_ed_adult, num_trees), pull(trees_and_asthma_ed_adult, average_annual_rate_per_10_000))

trees_and_asthma_ed_adult |> 
  ggplot(aes(x = trees_per_acre, y = average_annual_number)) +
  geom_point() +
  geom_smooth(se = FALSE)

cor(pull(trees_and_asthma_ed_adult, trees_per_acre), pull(trees_and_asthma_ed_adult, average_annual_number))

trees_and_asthma_ed_adult |> 
  ggplot(aes(x = num_trees, y = average_annual_number)) +
  geom_point() +
  geom_smooth(se = FALSE)

cor(pull(trees_and_asthma_ed_adult, num_trees), pull(trees_and_asthma_ed_adult, average_annual_number))

trees_and_asthma_ed_adult |> 
  mutate(nta_name = forcats::fct_reorder(nta_name, average_annual_age_adjusted_rate_per_10_000)) |>  
  ggplot(aes(x = nta_name, y = average_annual_age_adjusted_rate_per_10_000, color = trees_per_acre)) +
  geom_col() +
  theme(axis.text.x = element_text(angle=90, vjust=1, hjust=1))

trees_and_asthma_ed_adult |> 
  mutate(nta_name = forcats::fct_reorder(nta_name, average_annual_age_adjusted_rate_per_10_000)) |>  
  ggplot(aes(x = nta_name, y = average_annual_age_adjusted_rate_per_10_000, color = num_trees)) +
  geom_col() +
  theme(axis.text.x = element_text(angle=90, vjust=1, hjust=1))

```

