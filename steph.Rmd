---
title: "About"
---

# load packages
```{r, message = FALSE}
library(tidyverse)
library(readr)
library(readxl)
library(plotly)
```

# settings
```{r, message = FALSE}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "right"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Load cleaned tree data
Each line is an individual tree
```{r, message = FALSE}
tree_2015_cleaned <-
  read_csv("large_tree_data/2015_tree_raw.csv", na = c("", "NA", "Unknown")) |> 
  janitor::clean_names() |> 
  select(-created_at, -steward, -user_type, -st_senate, -st_assem, -state) 

```

# Load acres data
focusing just on 2010; uses 2010 NTAs
```{r}
acres_raw <- 
  read_excel("small_data/t_pl_p5_nta.xlsx", 
             range = "A9:J203", 
             col_names = c("borough", "county_code", "nta", "nta_name",
                           "total_pop_2000", "total_pop_2010", "pop_change_num",
                           "pop_change_per", "total_acres", "persons_per_acre")
             ) |> 
  janitor::clean_names()

acres_sub <- acres_raw |> 
  select(nta_name, total_acres)

```

# Create table summarizing number of trees per acre by nta
looking at only Alive trees; 6 NTAs from our tree census are missing acreage info so we removed these NTA from the analysis
```{r}
trees_per_nta <- tree_2015_cleaned |> 
  select(nta_name, nta, borough, status) |> 
  filter(status == "Alive") |> 
  count(nta_name, borough) |> 
  rename(num_trees = n)

trees_and_acres <- left_join(trees_per_nta, acres_sub, by = "nta_name")

num_missing_nta <- sum(is.na(trees_and_acres$total_acres))

trees_per_acre_df <- trees_and_acres |> 
  filter(!is.na(total_acres)) |> 
  mutate(trees_per_acre = num_trees/total_acres) |> 
  arrange(desc(trees_per_acre))

trees_per_acre_nta_table <- trees_per_acre_df |> 
  filter(min_rank(desc(trees_per_acre)) < 11) |> 
  knitr::kable(digits = 2, caption = "Top 10 NYC neighborhoods with the highest number of trees per acre")

trees_total_nta_table <- trees_per_acre_df |> 
  filter(min_rank(desc(num_trees)) < 11) |> 
  knitr::kable(digits = 2, caption = "Top 10 NYC neighborhoods with the highest total number of trees")

```

## Asthma Emergency Dept Adults 2017-2019
### load Asthma Emergency Dept Adults 2017-2019
```{r, message = FALSE}
asthma_ed_adults_raw = 
  read_csv("small_data/NYC EH Data Portal_Asthma emergency department visits adults.csv") |> 
  janitor::clean_names()

asthma_ed_adults_clean = asthma_ed_adults_raw |> 
  rename(nta_name = geography) |> 
  filter(geo_type == "NTA2010" & time == "2017-2019") |> 
  select(nta_name, average_annual_age_adjusted_rate_per_10_000, average_annual_rate_per_10_000)

```

### Summarize trees per acre by nta and asthma emergency dept adults
checked and no NAs are present
```{r}
trees_and_asthma_ed_adult <- left_join(trees_per_acre_df, asthma_ed_adults_clean, by = "nta_name")

m0 <- sum(is.na(trees_and_asthma_ed_adult))

```

### Tables and Graphs of trees per acre and asthma ED adults and num trees OVERALL NYC
when looking at histograms of x and y values most are skewed; can't do a test of significance
no to weak linear association
```{r}
#trees_and_asthma_ed_adult |> 
  #plot_ly(data = _, x = ~trees_per_acre, y = ~ average_annual_age_adjusted_rate_per_10_000, 
          #color = ~nta_name, 
          #type = "scatter",
          #mode - "markers",
          #text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>tree per acre: ", trees_per_acre, 
                        #"<br>rate of adult asthma ED visits: ", average_annual_age_adjusted_rate_per_10_000)) |> 
  #layout(title = "Trees per acre and rate of adult asthma emergency department visits <br> by neighborhood", 
         #xaxis = list(title = 'Number of trees per acre'),
         #yaxis = list(title = 'Average annual age-adjusted rate of <br> adult asthma emergency dept visits (per 10,000)'),
         #legend = list(title=list(text='Neighborhood')))

#cor(pull(trees_and_asthma_ed_adult, trees_per_acre), pull(trees_and_asthma_ed_adult, average_annual_age_adjusted_rate_per_10_000))

trees_and_asthma_ed_adult |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre, "<br>rate of adult asthma ED visits: ", 
                        average_annual_rate_per_10_000)) |> 
    layout(title = "Trees per acre and rate of adult asthma emergency department visits <br> by neighborhood in NYC",
           xaxis = list(title = 'Number of trees per acre'),
           yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
           legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_asthma_ed_adult, trees_per_acre), pull(trees_and_asthma_ed_adult, average_annual_rate_per_10_000))

#trees_and_asthma_ed_adult |> 
  #plot_ly(data = _, x = ~num_trees, y = ~average_annual_age_adjusted_rate_per_10_000,
          #color = ~nta_name, 
          #type = "scatter",
          #mode - "markers",
          #text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>number of trees: ", num_trees,
                        #"<br>rate of adult asthma ED visits: ", average_annual_age_adjusted_rate_per_10_000)) |>
  #layout(title = "Number of trees and rate of adult asthma emergency department visits <br> by neighborhood",
         #xaxis = list(title = 'Total number of trees'),
         #yaxis = list(title = 'Average annual age-adjusted rate of <br> adult asthma emergency dept visits (per 10,000)'),
         #legend = list(title=list(text='Neighborhood')))

#cor(pull(trees_and_asthma_ed_adult, num_trees), pull(trees_and_asthma_ed_adult, average_annual_age_adjusted_rate_per_10_000))

trees_and_asthma_ed_adult |> 
  plot_ly(data = _, x = ~num_trees, y = ~average_annual_rate_per_10_000,
          color = ~nta_name,
          type = "scatter", 
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>number of trees: ", num_trees, 
                        "<br>rate of adult asthma ED visits: ", average_annual_rate_per_10_000)) |> 
    layout(title = "Number of trees and rate of adult asthma emergency department visits <br> by neighborhood in NYC",
         xaxis = list(title = 'Total number of trees'),
         yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
         legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_asthma_ed_adult, num_trees), pull(trees_and_asthma_ed_adult, average_annual_rate_per_10_000))


```

### Tables and Graphs of trees per acre and asthma ED adults OVERLAY OF BOROUGH
```{r}
trees_and_asthma_ed_adult |> 
  filter(borough == "Manhattan") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre, "<br>rate of adult asthma ED visits: ", 
                        average_annual_rate_per_10_000)) |> 
    layout(title = "Trees per acre and rate of adult asthma emergency department visits <br> by neighborhood in Manhattan",
           xaxis = list(title = 'Number of trees per acre'),
           yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
           legend = list(title=list(text='Neighborhood')))

manhattan_per_acre_asthma_ed_adult <- trees_and_asthma_ed_adult |> 
  filter(borough == "Manhattan") 

cor(pull(manhattan_per_acre_asthma_ed_adult, trees_per_acre), pull(manhattan_per_acre_asthma_ed_adult, average_annual_rate_per_10_000))
```

```{r}
trees_and_asthma_ed_adult |> 
  filter(borough == "Bronx") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre, "<br>rate of adult asthma ED visits: ", 
                        average_annual_rate_per_10_000)) |> 
    layout(title = "Trees per acre and rate of adult asthma emergency department visits <br> by neighborhood in Bronx",
           xaxis = list(title = 'Number of trees per acre'),
           yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
           legend = list(title=list(text='Neighborhood')))

bronx_per_acre_asthma_ed_adult <- trees_and_asthma_ed_adult |> 
  filter(borough == "Bronx") 

cor(pull(bronx_per_acre_asthma_ed_adult, trees_per_acre), pull(bronx_per_acre_asthma_ed_adult, average_annual_rate_per_10_000))
```

```{r}
trees_and_asthma_ed_adult |> 
  filter(borough == "Brooklyn") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre, "<br>rate of adult asthma ED visits: ", 
                        average_annual_rate_per_10_000)) |> 
    layout(title = "Trees per acre and rate of adult asthma emergency department visits <br> by neighborhood in Brooklyn",
           xaxis = list(title = 'Number of trees per acre'),
           yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
           legend = list(title=list(text='Neighborhood')))

brooklyn_per_acre_asthma_ed_adult <- trees_and_asthma_ed_adult |> 
  filter(borough == "Brooklyn") 

cor(pull(brooklyn_per_acre_asthma_ed_adult, trees_per_acre), pull(brooklyn_per_acre_asthma_ed_adult, average_annual_rate_per_10_000))
```

```{r}
trees_and_asthma_ed_adult |> 
  filter(borough == "Staten Island") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre, "<br>rate of adult asthma ED visits: ", 
                        average_annual_rate_per_10_000)) |> 
    layout(title = "Trees per acre and rate of adult asthma emergency department visits <br> by neighborhood in Staten Island",
           xaxis = list(title = 'Number of trees per acre'),
           yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
           legend = list(title=list(text='Neighborhood')))

staten_island_per_acre_asthma_ed_adult <- trees_and_asthma_ed_adult |> 
  filter(borough == "Staten Island") 

cor(pull(staten_island_per_acre_asthma_ed_adult, trees_per_acre), pull(staten_island_per_acre_asthma_ed_adult, average_annual_rate_per_10_000))
```

```{r}
trees_and_asthma_ed_adult |> 
  filter(borough == "Queens") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre, "<br>rate of adult asthma ED visits: ", 
                        average_annual_rate_per_10_000)) |> 
    layout(title = "Trees per acre and rate of adult asthma emergency department visits <br> by neighborhood in Queens",
           xaxis = list(title = 'Number of trees per acre'),
           yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
           legend = list(title=list(text='Neighborhood')))

queens_per_acre_asthma_ed_adult <- trees_and_asthma_ed_adult |> 
  filter(borough == "Queens") 

cor(pull(queens_per_acre_asthma_ed_adult, trees_per_acre), pull(queens_per_acre_asthma_ed_adult, average_annual_rate_per_10_000))
```

## Asthma Hospitalizations Adults 2012-2014
### load Asthma Hospitalizations Adults 2012-2014
```{r}
asthma_hosp_adult_raw <-
  read_csv("small_data/NYC EH Data Portal - Asthma hospitalizations adults.csv") |> 
  janitor::clean_names()

asthma_hosp_adult_clean <- asthma_hosp_adult_raw |> 
  rename(nta_name = geography) |> 
  filter(geo_type == "NTA2010" & time == "2012-2014") |> 
  select(nta_name, average_annual_age_adjusted_rate_per_10_000, average_annual_rate_per_10_000)

```

### Summarize trees per acre by nta and asthma hospitalizations adults
checked and no NAs are present
```{r}
trees_and_asthma_hosp_adult <- left_join(trees_per_acre_df, asthma_hosp_adult_clean, by = "nta_name")

m1 <- sum(is.na(trees_and_asthma_hosp_adult))

```

### Tables and Graphs of trees per acre and asthma hospitalizations OVERALL NYC
when looking at histograms of x and y values most are skewed; can't do a test of significance

```{r}
#trees_and_asthma_hosp_adult |> 
  #plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_age_adjusted_rate_per_10_000, 
          #color = ~nta_name, 
          #type = "scatter",
          #mode - "markers",
          #text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>tree per acre: ", trees_per_acre,
                        #"<br>rate of adult asthma hospitalizations: ", average_annual_age_adjusted_rate_per_10_000)) |> 
  #layout(title = "Trees per acre and rate of adult asthma hospitalizations <br> by neighborhood",
         #xaxis = list(title = 'Number of trees per acre'),
         #yaxis = list(title = 'Average annual age-adjusted rate of <br> adult asthma emergency dept visits (per 10,000)'),
         #legend = list(title=list(text='Neighborhood')))

#cor(pull(trees_and_asthma_hosp_adult, trees_per_acre), pull(trees_and_asthma_hosp_adult, average_annual_age_adjusted_rate_per_10_000))

trees_and_asthma_hosp_adult |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre,
                        "<br>rate of adult asthma hospitalizations: ", average_annual_rate_per_10_000)) |> 
  layout(title = "Trees per acre and rate of adult asthma hospitalizations <br> by neighborhood in NYC",
         xaxis = list(title = 'Number of trees per acre'),
         yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
         legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_asthma_hosp_adult, trees_per_acre), pull(trees_and_asthma_hosp_adult, average_annual_rate_per_10_000))

#trees_and_asthma_hosp_adult |> 
  #plot_ly(data = _, x = ~num_trees, y = ~average_annual_age_adjusted_rate_per_10_000, 
          #color = ~nta_name, 
          #type = "scatter",
          #mode = "markers",
          #text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>number of trees: ", num_trees,
                        #"<br>rate of adult asthma hospitalizations: ", average_annual_age_adjusted_rate_per_10_000)) |> 
  #layout(title = "Number of trees and rate of adult asthma hospitalizations <br> by neighborhood",
         #xaxis = list(title = 'Total number of trees'),
         #yaxis = list(title = 'Average annual age-adjusted rate of <br> adult asthma emergency dept visits (per 10,000)'),
         #legend = list(title=list(text='Neighborhood')))

#cor(pull(trees_and_asthma_hosp_adult, num_trees), pull(trees_and_asthma_hosp_adult, average_annual_age_adjusted_rate_per_10_000))

trees_and_asthma_hosp_adult |> 
  plot_ly(data = _, x = ~num_trees, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>number of trees: ", num_trees,
                        "<br>rate of adult asthma hospitalizations: ", average_annual_rate_per_10_000)) |> 
  layout(title = "Number of trees and rate of adult asthma hospitalizations <br> by neighborhood",
         xaxis = list(title = 'Total number of trees'),
         yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
         legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_asthma_hosp_adult, num_trees), pull(trees_and_asthma_hosp_adult, average_annual_rate_per_10_000))

```

### Tables and Graphs of trees per acre and asthma hospitalizations OVERLAY BY BOROUGH

```{r}
trees_and_asthma_hosp_adult |> 
  filter(borough == "Manhattan") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre,
                        "<br>rate of adult asthma hospitalizations: ", average_annual_rate_per_10_000)) |> 
  layout(title = "Trees per acre and rate of adult asthma hospitalizations <br> by neighborhood in Manhattan",
         xaxis = list(title = 'Number of trees per acre'),
         yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
         legend = list(title=list(text='Neighborhood')))

manhattan_trees_and_asthma_hosp_adult <- trees_and_asthma_hosp_adult |> 
  filter(borough == "Manhattan")

cor(pull(manhattan_trees_and_asthma_hosp_adult, trees_per_acre), pull(manhattan_trees_and_asthma_hosp_adult, average_annual_rate_per_10_000))

trees_and_asthma_hosp_adult |> 
  filter(borough == "Bronx") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre,
                        "<br>rate of adult asthma hospitalizations: ", average_annual_rate_per_10_000)) |> 
  layout(title = "Trees per acre and rate of adult asthma hospitalizations <br> by neighborhood in Bronx",
         xaxis = list(title = 'Number of trees per acre'),
         yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
         legend = list(title=list(text='Neighborhood')))

bronx_trees_and_asthma_hosp_adult <- trees_and_asthma_hosp_adult |> 
  filter(borough == "Bronx")

cor(pull(bronx_trees_and_asthma_hosp_adult, trees_per_acre), pull(bronx_trees_and_asthma_hosp_adult, average_annual_rate_per_10_000))

trees_and_asthma_hosp_adult |> 
  filter(borough == "Brooklyn") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre,
                        "<br>rate of adult asthma hospitalizations: ", average_annual_rate_per_10_000)) |> 
  layout(title = "Trees per acre and rate of adult asthma hospitalizations <br> by neighborhood in Brooklyn",
         xaxis = list(title = 'Number of trees per acre'),
         yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
         legend = list(title=list(text='Neighborhood')))

brooklyn_trees_and_asthma_hosp_adult <- trees_and_asthma_hosp_adult |> 
  filter(borough == "Brooklyn")

cor(pull(brooklyn_trees_and_asthma_hosp_adult, trees_per_acre), pull(brooklyn_trees_and_asthma_hosp_adult, average_annual_rate_per_10_000))

trees_and_asthma_hosp_adult |> 
  filter(borough == "Staten Island") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre,
                        "<br>rate of adult asthma hospitalizations: ", average_annual_rate_per_10_000)) |> 
  layout(title = "Trees per acre and rate of adult asthma hospitalizations <br> by neighborhood in Staten Island",
         xaxis = list(title = 'Number of trees per acre'),
         yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
         legend = list(title=list(text='Neighborhood')))

staten_island_trees_and_asthma_hosp_adult <- trees_and_asthma_hosp_adult |> 
  filter(borough == "Staten Island")

cor(pull(staten_island_trees_and_asthma_hosp_adult, trees_per_acre), pull(staten_island_trees_and_asthma_hosp_adult, average_annual_rate_per_10_000))

trees_and_asthma_hosp_adult |> 
  filter(borough == "Queens") |> 
  plot_ly(data = _, x = ~trees_per_acre, y = ~average_annual_rate_per_10_000, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>tree per acre: ", trees_per_acre,
                        "<br>rate of adult asthma hospitalizations: ", average_annual_rate_per_10_000)) |> 
  layout(title = "Trees per acre and rate of adult asthma hospitalizations <br> by neighborhood in Queens",
         xaxis = list(title = 'Number of trees per acre'),
         yaxis = list(title = 'Average annual rate of <br> adult asthma emergency dept visits (per 10,000)'),
         legend = list(title=list(text='Neighborhood')))

queens_trees_and_asthma_hosp_adult <- trees_and_asthma_hosp_adult |> 
  filter(borough == "Queens")

cor(pull(queens_trees_and_asthma_hosp_adult, trees_per_acre), pull(queens_trees_and_asthma_hosp_adult, average_annual_rate_per_10_000))
```


## Neighborhood Poverty 2013-2017
### load Neighborhood Poverty 2013-2017

```{r, message = FALSE}
poverty_raw <-
  read_csv("large_tree_data/NYC EH Data Portal - Neighborhood poverty.csv") |> 
  janitor::clean_names()

poverty_clean <- poverty_raw |> 
  rename(nta_name = geography, poverty_percent = percent) |> 
  filter(geo_type == "NTA2010" & time == "2013-17") |> 
  select(nta_name, poverty_percent)

```

### Summarize trees per acre by nta and percent poverty
checked and no NAs are present
```{r}
trees_and_poverty <- left_join(trees_per_acre_df, poverty_clean, by = "nta_name")

m2 <- sum(is.na(trees_and_poverty))

```

### Tables and Graphs of trees per acre and asthma OVERALL NYC
when looking at histograms of x and y values most are skewed; can't do a test of significance
```{r}
trees_and_poverty |> 
  plot_ly(data = _, x = ~poverty_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>%below poverty line: ", poverty_percent, 
                        "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Percentage of people whose income is below the poverty line <br> and 
           trees per acre by neighborhood in NYC",
           xaxis = list(title = 'Percentage of people whose income <br> is below the poverty line'),
           yaxis = list(title = 'Number of trees per acre'),
           legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_poverty, trees_per_acre), pull(trees_and_poverty, poverty_percent))

trees_and_poverty |> 
  plot_ly(data = _, x = ~poverty_percent, y = ~num_trees, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>%below poverty line: ", 
                        poverty_percent, "<br>number of trees: ", num_trees)) |> 
    layout(title = "Percentage of people whose income is below the poverty line <br> 
           and number of trees by neighborhood",
           xaxis = list(title = 'Percentage of people whose income <br> is below the poverty line'),
           yaxis = list(title = 'Total number of trees'),
           legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_poverty, num_trees), pull(trees_and_poverty, poverty_percent))

```

### Tables and Graphs of trees per acre and asthma OVERLAY BY BOROUGH
```{r}
trees_and_poverty |> 
  filter(borough == "Manhattan") |> 
  plot_ly(data = _, x = ~poverty_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>%below poverty line: ", poverty_percent, 
                        "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Percentage of people whose income is below the poverty line <br> and 
           trees per acre by neighborhood in Manhattan",
           xaxis = list(title = 'Percentage of people whose income <br> is below the poverty line'),
           yaxis = list(title = 'Number of trees per acre'),
           legend = list(title=list(text='Neighborhood')))

manhattan_trees_and_poverty <- trees_and_poverty |> 
  filter(borough == "Manhattan")

cor(pull(manhattan_trees_and_poverty, trees_per_acre), pull(manhattan_trees_and_poverty, poverty_percent))

trees_and_poverty |> 
  filter(borough == "Brooklyn") |> 
  plot_ly(data = _, x = ~poverty_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>%below poverty line: ", poverty_percent, 
                        "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Percentage of people whose income is below the poverty line <br> and 
           trees per acre by neighborhood in Brooklyn",
           xaxis = list(title = 'Percentage of people whose income <br> is below the poverty line'),
           yaxis = list(title = 'Number of trees per acre'),
           legend = list(title=list(text='Neighborhood')))

brooklyn_trees_and_poverty <- trees_and_poverty |> 
  filter(borough == "Brooklyn")

cor(pull(brooklyn_trees_and_poverty, trees_per_acre), pull(brooklyn_trees_and_poverty, poverty_percent))

trees_and_poverty |> 
  filter(borough == "Bronx") |> 
  plot_ly(data = _, x = ~poverty_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>%below poverty line: ", poverty_percent, 
                        "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Percentage of people whose income is below the poverty line <br> and 
           trees per acre by neighborhood in Bronx",
           xaxis = list(title = 'Percentage of people whose income <br> is below the poverty line'),
           yaxis = list(title = 'Number of trees per acre'),
           legend = list(title=list(text='Neighborhood')))

bronx_trees_and_poverty <- trees_and_poverty |> 
  filter(borough == "Bronx")

cor(pull(bronx_trees_and_poverty, trees_per_acre), pull(bronx_trees_and_poverty, poverty_percent))

trees_and_poverty |> 
  filter(borough == "Staten Island") |> 
  plot_ly(data = _, x = ~poverty_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>%below poverty line: ", poverty_percent, 
                        "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Percentage of people whose income is below the poverty line <br> and 
           trees per acre by neighborhood in Staten Island",
           xaxis = list(title = 'Percentage of people whose income <br> is below the poverty line'),
           yaxis = list(title = 'Number of trees per acre'),
           legend = list(title=list(text='Neighborhood')))

staten_island_trees_and_poverty <- trees_and_poverty |> 
  filter(borough == "Staten Island")

cor(pull(staten_island_trees_and_poverty, trees_per_acre), pull(staten_island_trees_and_poverty, poverty_percent))

trees_and_poverty |> 
  filter(borough == "Queens") |> 
  plot_ly(data = _, x = ~poverty_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, 
                        "<br>%below poverty line: ", poverty_percent, 
                        "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Percentage of people whose income is below the poverty line <br> and 
           trees per acre by neighborhood in Queens",
           xaxis = list(title = 'Percentage of people whose income <br> is below the poverty line'),
           yaxis = list(title = 'Number of trees per acre'),
           legend = list(title=list(text='Neighborhood')))

queens_trees_and_poverty <- trees_and_poverty |> 
  filter(borough == "Queens")

cor(pull(queens_trees_and_poverty, trees_per_acre), pull(queens_trees_and_poverty, poverty_percent))
```

## Graduated High School 2013-2017
### load Graduated High School 2013-2017

```{r, message = FALSE}
education_raw <-
  read_csv("large_tree_data/NYC EH Data Portal - Graduated high school.csv") |> 
  janitor::clean_names()


education_clean <- education_raw |> 
  rename(nta_name = geography, graduated_hs_percent = percent) |> 
  filter(geo_type == "NTA2010" & time == "2013-17") |> 
  select(nta_name, graduated_hs_percent)

```

### Summarize trees per acre by nta and percent graduated high school
checked and no NAs are present
```{r}
trees_and_education <- left_join(trees_per_acre_df, education_clean, by = "nta_name")

m3 <- sum(is.na(trees_and_education))

```

### Tables and Graphs of trees per acre and education OVERALL NYC
when looking at histograms of x and y values most are skewed; can't do a test of significance
```{r}
trees_and_education |> 
  plot_ly(data = _, x = ~graduated_hs_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>% graduated HS: ", 
                        graduated_hs_percent, "<br>trees per acre: ", trees_per_acre)) |> 
  layout(title = "Percentage of people who graduated high school <br> and trees per acre by neighborhood in NYC", 
         xaxis = list(title = 'Percentage of people who graduated <br> high school (includes equivalency)'), 
         yaxis = list(title = 'Number of trees per acre'), 
         legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_education, trees_per_acre), pull(trees_and_education, graduated_hs_percent))

trees_and_education |> 
  plot_ly(data = _, x = ~graduated_hs_percent, y = ~num_trees, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>%people who graduated HS: ", 
                        graduated_hs_percent, "<br>number of trees: ", num_trees)) |> 
  layout(title = "Percentage of people who graduated high school <br> and number of trees by neighborhood",
         xaxis = list(title = 'Percentage of people who graduated <br> high school (includes equivalency)'),
         yaxis = list(title = 'Total number of trees'),
         legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_education, num_trees), pull(trees_and_education, graduated_hs_percent))

```

### Tables and Graphs of trees per acre and education OVERLAY BY BOROUGH

```{r}
trees_and_education |> 
  filter(borough == "Manhattan") |> 
  plot_ly(data = _, x = ~graduated_hs_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>% graduated HS: ", 
                        graduated_hs_percent, "<br>trees per acre: ", trees_per_acre)) |> 
  layout(title = "Percentage of people who graduated high school <br> and trees per acre by neighborhood in Manhattan", 
         xaxis = list(title = 'Percentage of people who graduated <br> high school (includes equivalency)'), 
         yaxis = list(title = 'Number of trees per acre'), 
         legend = list(title=list(text='Neighborhood')))

manhattan_trees_and_education <- trees_and_education |> 
  filter(borough == "Manhattan")

cor(pull(manhattan_trees_and_education, trees_per_acre), pull(manhattan_trees_and_education, graduated_hs_percent))

trees_and_education |> 
  filter(borough == "Brooklyn") |> 
  plot_ly(data = _, x = ~graduated_hs_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>% graduated HS: ", 
                        graduated_hs_percent, "<br>trees per acre: ", trees_per_acre)) |> 
  layout(title = "Percentage of people who graduated high school <br> and trees per acre by neighborhood in Brooklyn", 
         xaxis = list(title = 'Percentage of people who graduated <br> high school (includes equivalency)'), 
         yaxis = list(title = 'Number of trees per acre'), 
         legend = list(title=list(text='Neighborhood')))

brooklyn_trees_and_education <- trees_and_education |> 
  filter(borough == "Brooklyn")

cor(pull(brooklyn_trees_and_education, trees_per_acre), pull(brooklyn_trees_and_education, graduated_hs_percent))

trees_and_education |> 
  filter(borough == "Bronx") |> 
  plot_ly(data = _, x = ~graduated_hs_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>% graduated HS: ", 
                        graduated_hs_percent, "<br>trees per acre: ", trees_per_acre)) |> 
  layout(title = "Percentage of people who graduated high school <br> and trees per acre by neighborhood in Bronx", 
         xaxis = list(title = 'Percentage of people who graduated <br> high school (includes equivalency)'), 
         yaxis = list(title = 'Number of trees per acre'), 
         legend = list(title=list(text='Neighborhood')))

bronx_trees_and_education <- trees_and_education |> 
  filter(borough == "Bronx")

cor(pull(bronx_trees_and_education, trees_per_acre), pull(bronx_trees_and_education, graduated_hs_percent))

trees_and_education |> 
  filter(borough == "Staten Island") |> 
  plot_ly(data = _, x = ~graduated_hs_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>% graduated HS: ", 
                        graduated_hs_percent, "<br>trees per acre: ", trees_per_acre)) |> 
  layout(title = "Percentage of people who graduated high school <br> and trees per acre by neighborhood in Staten Island", 
         xaxis = list(title = 'Percentage of people who graduated <br> high school (includes equivalency)'), 
         yaxis = list(title = 'Number of trees per acre'), 
         legend = list(title=list(text='Neighborhood')))

staten_island_trees_and_education <- trees_and_education |> 
  filter(borough == "Staten Island")

cor(pull(staten_island_trees_and_education, trees_per_acre), pull(staten_island_trees_and_education, graduated_hs_percent))

trees_and_education |> 
  filter(borough == "Queens") |> 
  plot_ly(data = _, x = ~graduated_hs_percent, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", borough, "<br>% graduated HS: ", 
                        graduated_hs_percent, "<br>trees per acre: ", trees_per_acre)) |> 
  layout(title = "Percentage of people who graduated high school <br> and trees per acre by neighborhood in Queens", 
         xaxis = list(title = 'Percentage of people who graduated <br> high school (includes equivalency)'), 
         yaxis = list(title = 'Number of trees per acre'), 
         legend = list(title=list(text='Neighborhood')))

queens_trees_and_education <- trees_and_education |> 
  filter(borough == "Queens")

cor(pull(queens_trees_and_education, trees_per_acre), pull(queens_trees_and_education, graduated_hs_percent))
```



## NYCHA developments as of 2021
### load NYCHA dataset

```{r}
nycha_raw <-
  read_csv("large_tree_data/NYCHA_Residential_Addresses_20231130.csv") |> 
  janitor::clean_names()

nycha_clean <- nycha_raw |> 
  rename(nta_name = neighborhood_tabulation_area_name) |> 
  select(nta_name, development) |> 
  group_by(nta_name, development) |> 
  distinct() |> 
  ungroup()

num_dev_nta <- nycha_clean |> 
  count(nta_name) |> 
  rename(num_development = n)

```

### Summarize trees per acre by nta and number of NYCHA developments
if num_development was NA it was relabeled as 0; if no developments recorded for that nta, assumed that there are no developments in that nta
```{r}
trees_and_nycha <- left_join(trees_per_acre_df, num_dev_nta, by = "nta_name")

trees_and_nycha <- trees_and_nycha |> 
  mutate(num_development =
           ifelse(is.na(num_development), 0, num_development))

m4 <- sum(is.na(trees_and_nycha))

```

### Tables and Graphs of trees per acre and number of NYCHA developments OVERALL NYC
```{r}
trees_and_nycha |> 
  plot_ly(data = _, x = ~num_development, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", 
                        borough, "<br>number of NYCHA developments: ", 
                        num_development, "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Trees per acre and number of NYCHA developments by neighborhood in NYC",
           xaxis = list(title = 'Total number of NYCHA developments'), 
           yaxis = list(title = 'Number of trees per acre'), 
           legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_nycha, trees_per_acre), pull(trees_and_nycha, num_development))

trees_and_nycha |> 
  plot_ly(data = _, x = ~num_development, y = ~num_trees, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", 
                        borough, "<br>%number of NYCHA developments: ", 
                        num_development, "<br>number of trees: ", num_trees)) |> 
    layout(title = "Number of trees and number of NYCHA developments by neighborhood",
           xaxis = list(title = 'Total number of NYCHA developments'), 
           yaxis = list(title = 'Total number of trees'), 
           legend = list(title=list(text='Neighborhood')))

cor(pull(trees_and_nycha, num_trees), pull(trees_and_nycha, num_development))

```

### Tables and Graphs of trees per acre and number of NYCHA developments OVERLAY BY BOROUGH

```{r}
trees_and_nycha |> 
  filter(borough == "Manhattan") |> 
  plot_ly(data = _, x = ~num_development, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", 
                        borough, "<br>number of NYCHA developments: ", 
                        num_development, "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Trees per acre and number of NYCHA developments by neighborhood in Manhattan",
           xaxis = list(title = 'Total number of NYCHA developments'), 
           yaxis = list(title = 'Number of trees per acre'), 
           legend = list(title=list(text='Neighborhood')))

manhattan_trees_and_nycha <- trees_and_nycha |> 
  filter(borough == "Manhattan")

cor(pull(manhattan_trees_and_nycha, trees_per_acre), pull(manhattan_trees_and_nycha, num_development))


trees_and_nycha |> 
  filter(borough == "Brooklyn") |> 
  plot_ly(data = _, x = ~num_development, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", 
                        borough, "<br>number of NYCHA developments: ", 
                        num_development, "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Trees per acre and number of NYCHA developments by neighborhood in Brooklyn",
           xaxis = list(title = 'Total number of NYCHA developments'), 
           yaxis = list(title = 'Number of trees per acre'), 
           legend = list(title=list(text='Neighborhood')))

brooklyn_trees_and_nycha <- trees_and_nycha |> 
  filter(borough == "Brooklyn")

cor(pull(brooklyn_trees_and_nycha, trees_per_acre), pull(brooklyn_trees_and_nycha, num_development))


trees_and_nycha |> 
  filter(borough == "Bronx") |> 
  plot_ly(data = _, x = ~num_development, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", 
                        borough, "<br>number of NYCHA developments: ", 
                        num_development, "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Trees per acre and number of NYCHA developments by neighborhood in Bronx",
           xaxis = list(title = 'Total number of NYCHA developments'), 
           yaxis = list(title = 'Number of trees per acre'), 
           legend = list(title=list(text='Neighborhood')))

bronx_trees_and_nycha <- trees_and_nycha |> 
  filter(borough == "Bronx")

cor(pull(bronx_trees_and_nycha, trees_per_acre), pull(bronx_trees_and_nycha, num_development))

trees_and_nycha |> 
  filter(borough == "Staten Island") |> 
  plot_ly(data = _, x = ~num_development, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", 
                        borough, "<br>number of NYCHA developments: ", 
                        num_development, "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Trees per acre and number of NYCHA developments by neighborhood in Staten Island",
           xaxis = list(title = 'Total number of NYCHA developments'), 
           yaxis = list(title = 'Number of trees per acre'), 
           legend = list(title=list(text='Neighborhood')))

staten_island_trees_and_nycha <- trees_and_nycha |> 
  filter(borough == "Staten Island")

cor(pull(staten_island_trees_and_nycha, trees_per_acre), pull(staten_island_trees_and_nycha, num_development))


trees_and_nycha |> 
  filter(borough == "Queens") |> 
  plot_ly(data = _, x = ~num_development, y = ~trees_per_acre, 
          color = ~nta_name, 
          type = "scatter",
          mode = "markers",
          text = ~paste("neighborhood: ", nta_name, "<br>borough: ", 
                        borough, "<br>number of NYCHA developments: ", 
                        num_development, "<br>trees per acre: ", trees_per_acre)) |> 
    layout(title = "Trees per acre and number of NYCHA developments by neighborhood in Queens",
           xaxis = list(title = 'Total number of NYCHA developments'), 
           yaxis = list(title = 'Number of trees per acre'), 
           legend = list(title=list(text='Neighborhood')))

queens_trees_and_nycha <- trees_and_nycha |> 
  filter(borough == "Queens")

cor(pull(queens_trees_and_nycha, trees_per_acre), pull(queens_trees_and_nycha, num_development))

```

